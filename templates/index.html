<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobsearchAI Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">JobsearchAI Dashboard</h1>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="row">
            <!-- Left Column: CV Upload and Job Matcher -->
            <div class="col-md-6">
                <!-- CV Upload Form -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="h5 mb-0">Upload CV</h2>
                    </div>
                    <div class="card-body">
                        <form action="{{ url_for('upload_cv') }}" method="post" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="cv_file" class="form-label">Select CV File (PDF or DOCX)</label>
                                <input type="file" class="form-control" id="cv_file" name="cv_file" accept=".pdf,.docx" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Upload CV</button>
                        </form>
                    </div>
                </div>
                
                <!-- Job Matcher Form -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="h5 mb-0">Run Job Matcher</h2>
                    </div>
                    <div class="card-body">
                        <form action="{{ url_for('run_job_matcher') }}" method="post">
                            <div class="mb-3">
                                <label for="cv_path" class="form-label">Select CV</label>
                                <select class="form-select" id="cv_path" name="cv_path" required>
                                    <option value="">Select a CV</option>
                                    {% for cv_file in cv_files %}
                                        <option value="{{ cv_file }}">{{ cv_file }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="min_score" class="form-label">Minimum Match Score (1-10)</label>
                                <input type="number" class="form-control" id="min_score" name="min_score" min="1" max="10" value="3">
                            </div>
                            <div class="mb-3">
                                <label for="max_jobs" class="form-label">Max Jobs to Process</label>
                                <input type="number" class="form-control" id="max_jobs" name="max_jobs" min="1" max="200" value="50">
                                <div class="form-text">Maximum number of job listings to load and process from the data file.</div>
                            </div>
                            <div class="mb-3">
                                <label for="max_results" class="form-label">Max Results to Return</label>
                                <input type="number" class="form-control" id="max_results" name="max_results" min="1" max="50" value="10">
                                <div class="form-text">Maximum number of matched jobs to include in the final report.</div>
                            </div>
                            <button type="submit" class="btn btn-success">Run Job Matcher</button>
                        </form>
                    </div>
                </div>
                
                <!-- Combined Process Form -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0">Run Combined Process</h2>
                    </div>
                    <div class="card-body">
                        <p>Run both job data acquisition and job matching in one go.</p>
                        <form action="{{ url_for('run_combined_process') }}" method="post">
                            <div class="mb-3">
                                <label for="combined_cv_path" class="form-label">Select CV</label>
                                <select class="form-select" id="combined_cv_path" name="cv_path" required>
                                    <option value="">Select a CV</option>
                                    {% for cv_file in cv_files %}
                                        <option value="{{ cv_file }}">{{ cv_file }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="combined_max_pages" class="form-label">Maximum Pages to Scrape</label>
                                <input type="number" class="form-control" id="combined_max_pages" name="max_pages" min="1" max="500" value="50">
                                <div class="form-text">Maximum number of pages to scrape from the job listing website.</div>
                            </div>
                            <div class="mb-3">
                                <label for="combined_min_score" class="form-label">Minimum Match Score (1-10)</label>
                                <input type="number" class="form-control" id="combined_min_score" name="min_score" min="1" max="10" value="3">
                            </div>
                            <div class="mb-3">
                                <label for="combined_max_jobs" class="form-label">Max Jobs to Process</label>
                                <input type="number" class="form-control" id="combined_max_jobs" name="max_jobs" min="1" max="200" value="50">
                                <div class="form-text">Maximum number of job listings to load and process from the data file.</div>
                            </div>
                            <div class="mb-3">
                                <label for="combined_max_results" class="form-label">Max Results to Return</label>
                                <input type="number" class="form-control" id="combined_max_results" name="max_results" min="1" max="50" value="10">
                                <div class="form-text">Maximum number of matched jobs to include in the final report.</div>
                            </div>
                            <button type="submit" class="btn btn-primary">Run Combined Process</button>
                        </form>
                    </div>
                </div>
                
                <!-- Job Data Acquisition -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="h5 mb-0">Job Data Acquisition</h2>
                    </div>
                    <div class="card-body">
                        <p>Run the job data acquisition component to scrape job listings from ostjob.ch.</p>
                        <form action="{{ url_for('run_job_scraper') }}" method="post">
                            <div class="mb-3">
                                <label for="max_pages" class="form-label">Maximum Pages to Scrape</label>
                                <input type="number" class="form-control" id="max_pages" name="max_pages" min="1" max="500" value="50">
                                <div class="form-text">Maximum number of pages to scrape from the job listing website.</div>
                            </div>
                            <button type="submit" class="btn btn-warning">Run Job Scraper</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Available Data and Reports -->
            <div class="col-md-6">
                <!-- Available CVs -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="h5 mb-0">Available CVs</h2>
                    </div>
                    <div class="card-body">
                        {% if cv_files %}
                            <ul class="list-group" id="cv-list">
                                {% for cv_file in cv_files %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center flex-grow-1">
                                            <input type="checkbox" class="form-check-input me-2 cv-checkbox" value="{{ cv_file }}" data-file-type="cv">
                                            <span class="cv-filename">{{ cv_file }}</span>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <button class="btn btn-sm btn-outline-info view-cv-btn me-1" data-cv-file="{{ cv_file }}">View Summary</button>
                                            <a href="{{ url_for('delete_cv', cv_file=cv_file) }}"
                                               class="btn btn-sm delete-cv-btn single-delete-btn"
                                               data-cv-file="{{ cv_file }}"
                                               title="Delete CV file">
                                                <span aria-hidden="true">&times;</span>
                                            </a>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                            <button class="btn btn-danger mt-2 bulk-delete-btn" data-file-type="cv" style="display: none;">Delete Selected CVs</button>
                        {% else %}
                            <p>No CVs available. Upload a CV to get started.</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Available Job Data -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="h5 mb-0">Available Job Data</h2>
                    </div>
                    <div class="card-body">
                        {% if job_data_files %}
                            <ul class="list-group" id="job-data-list">
                                {% for job_data_file in job_data_files %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center flex-grow-1">
                                            <input type="checkbox" class="form-check-input me-2 job-data-checkbox" value="{{ job_data_file }}" data-file-type="job_data">
                                            <span>{{ job_data_file }}</span>
                                        </div>
                                        <a href="{{ url_for('delete_job_data', job_data_file=job_data_file) }}"
                                           class="btn btn-sm delete-job-data-btn single-delete-btn"
                                           data-job-data-file="{{ job_data_file }}"
                                           title="Delete job data file">
                                            <span aria-hidden="true">&times;</span>
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                            <button class="btn btn-danger mt-2 bulk-delete-btn" data-file-type="job_data" style="display: none;">Delete Selected Job Data</button>
                        {% else %}
                            <p>No job data available. Run the job scraper to get job data.</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Available Reports -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="h5 mb-0">Job Match Reports</h2>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-danger mb-2 bulk-delete-btn" data-file-type="report" style="display: none;">Delete Selected Reports</button> <!-- Moved button here -->
                        {% if report_files %}
                            <ul class="list-group" id="report-list">
                                {% for report_file in report_files %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center flex-grow-1">
                                            <input type="checkbox" class="form-check-input me-2 report-checkbox" value="{{ report_file }}" data-file-type="report">
                                            <span>{{ report_file }}</span>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <a href="{{ url_for('view_results', report_file=report_file) }}" class="btn btn-sm btn-outline-primary me-1">View</a>
                                            <a href="{{ url_for('download_report', report_file=report_file) }}" class="btn btn-sm btn-outline-secondary me-1">Download</a>
                                            <a href="{{ url_for('delete_report', report_file=report_file) }}"
                                               class="btn btn-sm delete-report-btn single-delete-btn"
                                               data-report-file="{{ report_file }}"
                                               title="Delete report file">
                                                <span aria-hidden="true">&times;</span>
                                            </a>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p>No job match reports available. Run the job matcher to generate reports.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CV Summary Modal -->
    <div class="modal fade" id="cvSummaryModal" tabindex="-1" aria-labelledby="cvSummaryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cvSummaryModalLabel">CV Summary</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="cv-summary-content"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
