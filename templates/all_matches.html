<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Job Matches - JobSearchAI</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>
    <div class="container-fluid mt-4">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{{ url_for('index') }}">
                        <i class="bi bi-house"></i> Dashboard
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    All Job Matches
                </li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1><i class="bi bi-table"></i> All Job Matches</h1>
                <p class="lead text-muted">Unified database of all job matches across search terms and CV versions</p>
            </div>
            <div>
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Filter Panel -->
        <div class="filter-panel">
            <h2>Filters</h2>
            <form id="filter-form" method="GET" action="{{ url_for('job_matching.view_all_matches') }}">
                <div class="filter-row">
                    <div class="filter-field">
                        <label for="search_term">Search Term:</label>
                        <select id="search_term" name="search_term">
                            <option value="">All Search Terms</option>
                            {% for term in available_search_terms %}
                            <option value="{{ term }}" {% if filters.search_term==term %}selected{% endif %}>
                                {{ term }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-field">
                        <label for="cv_key">CV Version:</label>
                        <select id="cv_key" name="cv_key">
                            <option value="">All CV Versions</option>
                            {% for cv in available_cvs %}
                            <option value="{{ cv.cv_key }}" {% if filters.cv_key==cv.cv_key %}selected{% endif %}>
                                {{ cv.file_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-field">
                        <label for="min_score">Min Score:</label>
                        <input type="number" id="min_score" name="min_score" min="0" max="10" step="1"
                            value="{{ filters.min_score }}" placeholder="0-10">
                    </div>
                </div>

                <div class="filter-row">
                    <div class="filter-field">
                        <label for="location">Location:</label>
                        <input type="text" id="location" name="location" value="{{ filters.location }}"
                            placeholder="e.g., Z√ºrich">
                    </div>

                    <div class="filter-field">
                        <label for="date_from">From Date:</label>
                        <input type="date" id="date_from" name="date_from" value="{{ filters.date_from }}">
                    </div>

                    <div class="filter-field">
                        <label for="date_to">To Date:</label>
                        <input type="date" id="date_to" name="date_to" value="{{ filters.date_to }}">
                    </div>

                    <div class="filter-field">
                        <label for="sort_by">Sort By:</label>
                        <select id="sort_by" name="sort_by">
                            <option value="overall_match DESC" {% if filters.sort_by=='overall_match DESC' %}selected{%
                                endif %}>
                                Score (High to Low)
                            </option>
                            <option value="overall_match ASC" {% if filters.sort_by=='overall_match ASC' %}selected{%
                                endif %}>
                                Score (Low to High)
                            </option>
                            <option value="matched_at DESC" {% if filters.sort_by=='matched_at DESC' %}selected{% endif
                                %}>
                                Date (Newest First)
                            </option>
                            <option value="matched_at ASC" {% if filters.sort_by=='matched_at ASC' %}selected{% endif
                                %}>
                                Date (Oldest First)
                            </option>
                            <option value="company_name ASC" {% if filters.sort_by=='company_name ASC' %}selected{%
                                endif %}>
                                Company Name (A-Z)
                            </option>
                            <option value="job_title ASC" {% if filters.sort_by=='job_title ASC' %}selected{% endif %}>
                                Job Title (A-Z)
                            </option>
                        </select>
                    </div>
                </div>

                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                    <button type="button" class="btn btn-secondary" onclick="resetFilters()">Reset</button>
                </div>
            </form>
        </div>

        <!-- Feature Discovery Banner -->
        <div class="alert alert-info alert-dismissible fade show" role="alert" id="linkedin-feature-banner">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="bi bi-linkedin" style="font-size: 2rem;"></i>
                </div>
                <div class="flex-grow-1">
                    <h5 class="alert-heading mb-1"><strong>üéâ New Feature:</strong> LinkedIn Outreach Generator!</h5>
                    <p class="mb-0">Generate personalized LinkedIn messages instantly! Click the <i
                            class="bi bi-linkedin"></i> button next to any job to create Connection Requests, Peer
                        Networking messages, and InMail templates.</p>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary">
            <p>Showing {{ results|length }} of {{ total_count }} matches (Page {{ current_page }} of {{ total_pages }})
            </p>
            <div class="bulk-actions">
                <button id="btn-select-all" class="btn btn-secondary" onclick="selectAll()">Select All</button>
                <button id="btn-deselect-all" class="btn btn-secondary" onclick="deselectAll()">Deselect All</button>
                <button id="btn-generate-letters" class="btn btn-primary" onclick="generateLetters()" disabled>
                    Generate Letters for Selected (0)
                </button>
            </div>
        </div>

        <!-- Results Table -->
        {% if results %}
        <div class="results-table-container">
            <table class="results-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="select-all-header" onchange="toggleAllCheckboxes()">
                        </th>
                        <th>Status</th>
                        <th>Job Title</th>
                        <th>Company</th>
                        <th>Location</th>
                        <th>Score</th>
                        <th>Search Term</th>
                        <th>Date Matched</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for match in results %}
                    <tr {% if match.has_motivation_letter %}class="table-info" {% endif %}
                        data-job-match-id="{{ match.id }}">
                        <td>
                            <input type="checkbox" class="job-checkbox" value="{{ match.job_url }}"
                                onchange="updateBulkActions()">
                        </td>
                        <!-- Status Badge Column -->
                        <td>
                            <span class="badge status-badge" data-current-status="{{ match.status }}"
                                data-job-match-id="{{ match.id }}">
                                {{ match.status | title }}
                            </span>
                            {% if match.is_stale %}
                            <span class="stale-indicator" title="No updates in 7+ days">
                                <i class="bi bi-clock-history"></i>
                            </span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ match.job_url }}" target="_blank" rel="noopener noreferrer">
                                {{ match.job_title or 'N/A' }}
                            </a>
                            {% if match.has_motivation_letter %}
                            <i class="bi bi-envelope-check-fill text-success ms-1" title="Letter generated"
                                style="font-size: 0.9em;"></i>
                            {% endif %}
                        </td>
                        <td>{{ match.company_name or 'N/A' }}</td>
                        <td>{{ match.location or 'N/A' }}</td>
                        <td>
                            <span class="score-badge score-{{ match.score_class }}">
                                {{ match.overall_match }}/10
                            </span>
                        </td>
                        <td>
                            <span class="search-term-badge">{{ match.search_term }}</span>
                        </td>
                        <td>{{ match.matched_at[:10] if match.matched_at else 'N/A' }}</td>
                        <td>
                            <div class="d-flex gap-1">
                                <!-- LinkedIn Button - Direct Access -->
                                <button class="btn btn-outline-primary btn-sm linkedin-btn" type="button"
                                    data-bs-toggle="modal" data-bs-target="#linkedinModal"
                                    data-job-url="{{ match.job_url }}" data-job-title="{{ match.job_title }}"
                                    data-company="{{ match.company_name }}" title="Generate LinkedIn Outreach Messages">
                                    <i class="bi bi-linkedin"></i>
                                </button>

                                <!-- Actions Dropdown -->
                                <div class="dropdown">
                                    <button class="btn btn-secondary btn-sm dropdown-toggle" type="button"
                                        id="actionsDropdown{{ loop.index }}" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        Actions
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="actionsDropdown{{ loop.index }}">
                                        <!-- Status Change Options - Direct (No Nested Dropdown) -->
                                        <li><h6 class="dropdown-header"><i class="bi bi-arrow-repeat"></i> Change Status</h6></li>
                                        <li><a class="dropdown-item" href="#"
                                                onclick="updateStatus({{ match.id }}, 'INTERESTED'); return false;">
                                                <span class="badge" style="background-color: #0d6efd; width: 20px; height: 12px; display: inline-block; margin-right: 8px;"></span> Interested
                                            </a></li>
                                        <li><a class="dropdown-item" href="#"
                                                onclick="updateStatus({{ match.id }}, 'PREPARING'); return false;">
                                                <span class="badge" style="background-color: #ffc107; width: 20px; height: 12px; display: inline-block; margin-right: 8px;"></span> Preparing
                                            </a></li>
                                        <li><a class="dropdown-item" href="#"
                                                onclick="updateStatus({{ match.id }}, 'APPLIED'); return false;">
                                                <span class="badge" style="background-color: #198754; width: 20px; height: 12px; display: inline-block; margin-right: 8px;"></span> Applied
                                            </a></li>
                                        <li><a class="dropdown-item" href="#"
                                                onclick="updateStatus({{ match.id }}, 'INTERVIEW'); return false;">
                                                <span class="badge" style="background-color: #6f42c1; width: 20px; height: 12px; display: inline-block; margin-right: 8px;"></span> Interview
                                            </a></li>
                                        <li><a class="dropdown-item" href="#"
                                                onclick="updateStatus({{ match.id }}, 'OFFER'); return false;">
                                                <span class="badge" style="background-color: #20c997; width: 20px; height: 12px; display: inline-block; margin-right: 8px;"></span> Offer
                                            </a></li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>
                                        <li><a class="dropdown-item text-danger" href="#"
                                                onclick="updateStatus({{ match.id }}, 'REJECTED'); return false;">
                                                <span class="badge bg-danger" style="width: 20px; height: 12px; display: inline-block; margin-right: 8px;"></span> Rejected
                                            </a></li>
                                        <li><a class="dropdown-item text-muted" href="#"
                                                onclick="updateStatus({{ match.id }}, 'ARCHIVED'); return false;">
                                                <span class="badge bg-secondary" style="width: 20px; height: 12px; display: inline-block; margin-right: 8px;"></span> Archive
                                            </a></li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>

                                        <!-- LinkedIn Action (also in dropdown for discoverability) -->
                                        <li>
                                            <button class="dropdown-item linkedin-btn-dropdown" type="button"
                                                data-bs-toggle="modal" data-bs-target="#linkedinModal"
                                                data-job-url="{{ match.job_url }}"
                                                data-job-title="{{ match.job_title }}"
                                                data-company="{{ match.company_name }}">
                                                <i class="bi bi-linkedin"></i> LinkedIn Outreach
                                            </button>
                                        </li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>

                                        <!-- View Actions -->
                                        <li><a class="dropdown-item" href="#"
                                                onclick="viewReasoning('{{ match.job_url }}'); return false;">
                                                <i class="bi bi-eye"></i> View Reasoning
                                            </a></li>
                                        <li><a class="dropdown-item" href="{{ match.job_url }}" target="_blank"
                                                rel="noopener noreferrer">
                                                <i class="bi bi-box-arrow-up-right"></i> View Job Ad
                                            </a></li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>

                                        <!-- Generation Actions -->
                                        <li><a class="dropdown-item" href="#"
                                                onclick="generateLetter('{{ match.job_url }}', 'Lebenslauf_-_Lutz_Claudio'); return false;">
                                                <i class="bi bi-file-earmark-text"></i> Generate Letter
                                            </a></li>
                                        <li><a class="dropdown-item" href="#"
                                                onclick="generateLetterManual('{{ match.job_url }}', 'Lebenslauf_-_Lutz_Claudio'); return false;">
                                                <i class="bi bi-pencil-square"></i> Generate Letter (Manual Text)
                                            </a></li>
                                        <li><a class="dropdown-item" href="#"
                                                onclick="generateLetterAndCVManual('{{ match.job_url }}', 'Lebenslauf_-_Lutz_Claudio'); return false;">
                                                <i class="bi bi-file-earmark-text-fill"></i> Generate Letter and CV
                                                (Manual Text)
                                            </a></li>

                                        <!-- Document Actions (conditional) -->
                                        {% if match.has_docx %}
                                        <li><a class="dropdown-item"
                                                href="{{ url_for('motivation_letter.download_motivation_letter_docx', file_path=match.motivation_letter_docx_path) }}">
                                                <i class="bi bi-file-word"></i> Download Word
                                            </a></li>
                                        {% endif %}

                                        {% if match.has_scraped_data %}
                                        <li><a class="dropdown-item"
                                                href="{{ url_for('motivation_letter.view_scraped_data', scraped_data_filename=match.scraped_data_filename) }}">
                                                <i class="bi bi-file-code"></i> View Scraped Data
                                            </a></li>
                                        {% endif %}

                                        {% if match.has_email_text %}
                                        <li><a class="dropdown-item"
                                                href="{{ url_for('motivation_letter.view_email_text', json_path=match.motivation_letter_json_path) }}">
                                                <i class="bi bi-envelope"></i> View Email Text
                                            </a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            {% if current_page > 1 %}
            <a href="?{% for key, value in filters.items() %}{% if value %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ current_page - 1 }}"
                class="btn btn-secondary">‚Üê Previous</a>
            {% else %}
            <button class="btn btn-secondary" disabled>‚Üê Previous</button>
            {% endif %}

            <span class="page-info">Page {{ current_page }} of {{ total_pages }}</span>

            {% if current_page < total_pages %} <a
                href="?{% for key, value in filters.items() %}{% if value %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ current_page + 1 }}"
                class="btn btn-secondary">Next ‚Üí</a>
                {% else %}
                <button class="btn btn-secondary" disabled>Next ‚Üí</button>
                {% endif %}
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <h3>Export Options</h3>
            <button class="btn btn-secondary" onclick="exportToCSV()">Export to CSV</button>
            <button class="btn btn-secondary" onclick="exportToMarkdown()">Export to Markdown</button>
        </div>
        {% else %}
        <div class="no-results">
            <p>No job matches found. Try adjusting your filters.</p>
        </div>
        {% endif %}
    </div>

    <!-- View Reasoning Modal -->
    <div class="modal fade" id="reasoningModal" tabindex="-1" aria-labelledby="reasoningModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reasoningModalLabel">Match Reasoning</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6 id="reasoning-job-title" class="mb-3"></h6>
                    <div id="reasoning-content" style="white-space: pre-wrap;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- LinkedIn Outreach Modal -->
    <div class="modal fade" id="linkedinModal" tabindex="-1" aria-labelledby="linkedinModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="linkedinModalLabel">LinkedIn Outreach Generator</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="linkedinLoading" class="text-center d-none">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Generating personalized messages...</p>
                    </div>

                    <div id="linkedinContent" class="d-none">
                        <ul class="nav nav-tabs" id="linkedinTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="connection-tab" data-bs-toggle="tab"
                                    data-bs-target="#connection" type="button" role="tab" aria-controls="connection"
                                    aria-selected="true">Connection Request</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="peer-tab" data-bs-toggle="tab" data-bs-target="#peer"
                                    type="button" role="tab" aria-controls="peer" aria-selected="false">Peer
                                    Networking</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="inmail-tab" data-bs-toggle="tab" data-bs-target="#inmail"
                                    type="button" role="tab" aria-controls="inmail"
                                    aria-selected="false">InMail</button>
                            </li>
                        </ul>
                        <div class="tab-content p-3 border border-top-0 rounded-bottom" id="linkedinTabContent">
                            <div class="tab-pane fade show active" id="connection" role="tabpanel"
                                aria-labelledby="connection-tab">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">Max 300 chars</small>
                                    <button class="btn btn-sm btn-outline-primary copy-btn"
                                        data-target="connection-text">Copy</button>
                                </div>
                                <textarea class="form-control" id="connection-text" rows="5" readonly></textarea>
                                <div class="text-end mt-1"><small id="connection-count" class="text-muted">0/300</small>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="peer" role="tabpanel" aria-labelledby="peer-tab">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">Casual tone</small>
                                    <button class="btn btn-sm btn-outline-primary copy-btn"
                                        data-target="peer-text">Copy</button>
                                </div>
                                <textarea class="form-control" id="peer-text" rows="8" readonly></textarea>
                            </div>
                            <div class="tab-pane fade" id="inmail" role="tabpanel" aria-labelledby="inmail-tab">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">Longer pitch</small>
                                    <button class="btn btn-sm btn-outline-primary copy-btn"
                                        data-target="inmail-text">Copy</button>
                                </div>
                                <textarea class="form-control" id="inmail-text" rows="10" readonly></textarea>
                            </div>
                        </div>
                    </div>

                    <div id="linkedinError" class="alert alert-danger d-none mt-3"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="regenerateBtn">Regenerate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Text Input Modal -->
    <div class="modal fade" id="manualTextModal" tabindex="-1" aria-labelledby="manualTextModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="manualTextModalLabel">Manual Job Text Input</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Paste the full job description text below. The system will attempt to structure this text and
                        then generate the motivation letter.</p>
                    <div class="mb-3">
                        <label for="manualJobUrl" class="form-label">Job URL:</label>
                        <input type="text" class="form-control" id="manualJobUrl" readonly>
                    </div>
                    <input type="hidden" id="manualCvFilename">
                    <input type="hidden" id="manualGenerateCV" value="false">
                    <div class="mb-3">
                        <label for="manualJobTextInput" class="form-label">Job Announcement Text:</label>
                        <textarea class="form-control" id="manualJobTextInput" rows="15"
                            placeholder="Paste the job description here..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitManualTextBtn">Generate from Text</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container for Status Notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="statusToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Status Update</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Dynamic message -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/status_management.js') }}"></script>
    <script src="{{ url_for('static', filename='js/all_matches.js') }}"></script>

    <script>
        // LinkedIn Modal Functionality
        let currentJobUrl = '';
        let currentCvFilename = 'Lebenslauf_-_Lutz_Claudio'; // Default CV filename

        var linkedinModal = document.getElementById('linkedinModal');
        linkedinModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var jobUrl = button.getAttribute('data-job-url');
            var jobTitle = button.getAttribute('data-job-title');
            var company = button.getAttribute('data-company');

            currentJobUrl = jobUrl;

            // Update title
            var modalTitle = linkedinModal.querySelector('.modal-title');
            modalTitle.textContent = 'LinkedIn Outreach: ' + company;

            // Reset state
            document.getElementById('linkedinContent').classList.add('d-none');
            document.getElementById('linkedinError').classList.add('d-none');
            document.getElementById('linkedinLoading').classList.remove('d-none');

            // Call API
            generateLinkedInMessages(jobUrl, currentCvFilename);
        });

        document.getElementById('regenerateBtn').addEventListener('click', function () {
            document.getElementById('linkedinContent').classList.add('d-none');
            document.getElementById('linkedinLoading').classList.remove('d-none');
            document.getElementById('linkedinError').classList.add('d-none');
            generateLinkedInMessages(currentJobUrl, currentCvFilename);
        });

        function generateLinkedInMessages(jobUrl, cvFilename) {
            fetch('/linkedin/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    job_url: jobUrl,
                    cv_filename: cvFilename
                })
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('linkedinLoading').classList.add('d-none');

                    if (data.success) {
                        document.getElementById('linkedinContent').classList.remove('d-none');

                        // Populate fields
                        const msgs = data.data;
                        document.getElementById('connection-text').value = msgs.connection_request_hiring_manager;
                        document.getElementById('peer-text').value = msgs.peer_networking;
                        document.getElementById('inmail-text').value = msgs.inmail_message;

                        // Update char count
                        const charCount = msgs.connection_request_hiring_manager.length;
                        document.getElementById('connection-count').textContent = charCount + '/300';
                        if (charCount > 300) {
                            document.getElementById('connection-count').classList.add('text-danger');
                        } else {
                            document.getElementById('connection-count').classList.remove('text-danger');
                        }
                    } else {
                        showLinkedInError(data.error || 'Unknown error occurred');
                    }
                })
                .catch(error => {
                    document.getElementById('linkedinLoading').classList.add('d-none');
                    showLinkedInError('Network error: ' + error.message);
                });
        }

        function showLinkedInError(msg) {
            var errorDiv = document.getElementById('linkedinError');
            errorDiv.textContent = msg;
            errorDiv.classList.remove('d-none');
        }

        // Copy functionality
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                var targetId = this.getAttribute('data-target');
                var text = document.getElementById(targetId).value;

                navigator.clipboard.writeText(text).then(() => {
                    var originalText = this.textContent;
                    this.textContent = 'Copied!';
                    this.classList.remove('btn-outline-primary');
                    this.classList.add('btn-success');

                    setTimeout(() => {
                        this.textContent = originalText;
                        this.classList.add('btn-outline-primary');
                        this.classList.remove('btn-success');
                    }, 2000);
                });
            });
        });
    </script>
</body>

</html>
